#https://docs.conan.io/2/reference/config_files/settings.html

[settings]
os=Windows
arch=x86_64
build_type=Release
compiler=msvc
compiler.version=194
compiler.cppstd=20

#compiler=clang
#compiler.version=21
#compiler.libcxx=c++_static
#compiler.runtime_version=v144
#compiler.cppstd=20

compiler.runtime=dynamic
compiler.runtime_type=Release

[options]
*:shared=False

[conf]
tools.build:jobs=8
tools.cmake.cmaketoolchain:generator=Ninja
tools.cmake.cmakedeps:new=will_break_next

# Set compilers and abi
# Since using libc++ directly with the MSVC compiler is not straightforward, the recommended approach is to use the Clang compiler in clang-cl mode.
tools.build:compiler_executables={'c': '$ENV{DEVCRAFT_WORKSPACE}/llvm/llvm-21/$ENV{DEVCRAFT_HOST_TRIPLE}/bin/clang-cl${CMAKE_HOST_EXECUTABLE_SUFFIX}', 'cpp': '$ENV{DEVCRAFT_WORKSPACE}/llvm/llvm-21/$ENV{DEVCRAFT_HOST_TRIPLE}/bin/clang-cl${CMAKE_HOST_EXECUTABLE_SUFFIX}', 'ld': '$ENV{DEVCRAFT_WORKSPACE}/llvm/llvm-21/$ENV{DEVCRAFT_HOST_TRIPLE}/bin/lld${CMAKE_HOST_EXECUTABLE_SUFFIX}'}
tools.cmake.cmaketoolchain:extra_variables={"TARGET_TRIPLE": "x86_64-windows-msvc", "CMAKE_CXX_COMPILER_TARGET": "x86_64-windows-msvc", "CMAKE_C_COMPILER_TARGET": "x86_64-windows-msvc", "CMAKE_ASM_COMPILER_TARGET":"x86_64-windows-msvc", "CMAKE_LINKER_TYPE": "LLD"}

# Set to use MSVC-compatible flags with clang-cl
# Note: clang-cl doesn't support -stdlib=libc++, it uses MSVC's standard library
# tools.build:cxxflags=+["-stdlib=libc++"]

# Set VS Studio and winsdk to use
tools.microsoft.msbuild:vs_version=18
tools.microsoft:winsdk_version=10.0.26100.0

#tools.build:sharedlinkflags=+["-lmsvcrt.lib"]
#tools.build:exelinkflags=+["-lmsvcrt.lib"]

# For debug
#tools.microsoft.msbuild:installation_path=X:/conan/msvc/build/2022/Community
#tools.build:cxxflags=+["-D_CRT_SECURE_NO_WARNINGS"]
#tools.build:cxxflags=+["-DWIN32_LEAN_AND_MEAN", "-D_WIN32_WINNT=0x0601", "-D_CRT_SECURE_NO_WARNINGS", "-Wno-microsoft-cpp-macro", "-Wno-gnu-anonymous-struct", "-Wno-language-extension-token"]
#tools.build:cxxflags=+["-v"]


[buildenv]
CONAN_BUILD_ENV_CHECK=true
CLANG_FOR_CODEGEN=$ENV{DEVCRAFT_WORKSPACE}/llvm/llvm-21/$ENV{DEVCRAFT_HOST_TRIPLE}/bin/clang++${CMAKE_HOST_EXECUTABLE_SUFFIX}